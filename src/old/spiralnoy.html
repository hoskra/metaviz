<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="canvas">
  <meta name="author" content="hoskra">
  <script src="../libs/p5.min.js" type="text/javascript" defer></script>
  <script src="../libs/d3-delaunay@6.js" type="text/javascript" defer></script>
  <title>Spiral</title>
  <style>
    body {
      margin: 0;
    }
  </style>
</head>

<body>
</body>
<script>
// https://softwareengineering.stackexchange.com/questions/181285/randomly-generate-points-in-a-spiral-motion-using-javascript/181291

let p = []
const simplifiedPolygons = [];


let f = 0
let W = 600
let spiral=[]

let a = 5;
let off = 10;
let num = 50;
let numArms = 1;

let TOGGLE_VORONOI = true
let TOGGLE_DELAUNAY = false


function setup() {
  createCanvas(W, W)
}

function draw() {
  f += 0.01

  background(0)

  fill(255)
  noStroke()


  spiral = []
  for (let arm = 0; arm < numArms; arm++) {
  for (let p = 0; p < num; p++) {
      let pX = a * p * Math.cos(f + p + (Math.PI * arm));
      let pY = a * p * Math.sin(f + p + (Math.PI * arm));
      pX = Math.sign(pX) * (Math.abs(pX) + p)
      pY = Math.sign(pY) * (Math.abs(pY) + p)
      spiral.push([pX, pY]);
    }
  }


  push()
  translate(W/2, W/2)

  const delaunay = d3.Delaunay.from(spiral);
  const { points,halfedges,triangles} = delaunay;
  const voronoi = delaunay.voronoi([-W/2, -W/2, W, W])

    background(255)
    strokeWeight(1)

    const simplifiedPolygons = [];

    for (let cell of voronoi.cellPolygons()) {
      let polygon = [];
      for (let vertex of cell)
        polygon.push([vertex[0], vertex[1]]);
      simplifiedPolygons.push(polygon);
    }

    stroke(0)

    if(TOGGLE_DELAUNAY)
    for (let i = 0; i < points.length; i++) {
      const t0 = triangles[i * 3 + 0];
      const t1 = triangles[i * 3 + 1];
      const t2 = triangles[i * 3 + 2];
      x = [points[t0 * 2], points[t0 * 2 + 1]];
      y = [points[t1 * 2], points[t1 * 2 + 1]];
      z = [points[t2 * 2], points[t2 * 2 + 1]];
      line(x[0],x[1],y[0],y[1])
      line(y[0],y[1],z[0],z[1])
      line(z[0],z[1],x[0],x[1])
      // m = (Math.max(x[1], y[1]), z[1])
      // m = map(m, 0, 255, 0, 255)
      fill(0,50)
      triangle(x[0], x[1], y[0], y[1], z[0], z[1])
    }

    stroke(0)

    if(TOGGLE_VORONOI)
    for (let i = 0; i < simplifiedPolygons.length; i++) {
      let len = simplifiedPolygons[i].length
      for (let j = 0; j < simplifiedPolygons[i].length - 1; j++) {
        line(simplifiedPolygons[i][j][0], simplifiedPolygons[i][j][1],
          simplifiedPolygons[i][(j + 1) % len][0], simplifiedPolygons[i][(j + 1) % len][1])
      }
    }

  for(coord of spiral)
    circle(coord[0], coord[1], 10);
  pop()

}

</script>
</html>